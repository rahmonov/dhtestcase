import pytest
from rest_framework.reverse import reverse

from restaurant.models import Restaurant


@pytest.mark.django_db
def test_can_get_list_of_restaurants(overlapping_restaurants, api_client):
    response = api_client.get(reverse('restaurant:restaurants'))

    assert response.status_code == 200
    assert response.data['type'] == 'FeatureCollection'
    assert len(response.data['features']) == 4


@pytest.mark.django_db
def test_can_create_restaurant(api_client):
    data = {
        'name': 'New Restaurant',
        'location': {"type": "Point", "coordinates": [52.5247258, 13.39303289999998]},
        'delivery_area': {"type": "Polygon", "coordinates": [
            [[13.39303289999998, 52.5337089528412], [13.395913937206183, 52.53353630910886],
             [13.39868419197304, 52.533025016495436], [13.401237149192186, 52.53219473502801],
             [13.403474662897601, 52.53107738892567], [13.405310733632021, 52.529715937184704],
             [13.406674815342607, 52.528162719640235], [13.407514524422746, 52.5264774425287],
             [13.40779764710031, 52.52472488142933], [13.407513368897478, 52.522972390251994],
             [13.406672680210292, 52.521287312261535], [13.405307943947166, 52.519734392722825],
             [13.40347164336441, 52.51837329250363], [13.401234359507212, 52.517256297923076],
             [13.398682056840562, 52.516426314461434], [13.3959127816808, 52.51591522096912],
             [13.39303289999998, 52.51574264715881], [13.390153018319161, 52.51591522096912],
             [13.387383743159399, 52.516426314461434], [13.384831440492748, 52.517256297923076],
             [13.38259415663555, 52.51837329250363], [13.380757856052794, 52.519734392722825],
             [13.37939311978967, 52.521287312261535], [13.378552431102484, 52.522972390251994],
             [13.37826815289965, 52.52472488142933], [13.378551275577214, 52.5264774425287],
             [13.379390984657354, 52.528162719640235], [13.38075506636794, 52.529715937184704],
             [13.382591137102361, 52.53107738892567], [13.384828650807776, 52.53219473502801],
             [13.387381608026923, 52.533025016495436], [13.390151862793777, 52.53353630910886],
             [13.39303289999998, 52.5337089528412]]]}
    }

    response = api_client.post(reverse('restaurant:restaurants'), data, format='json')

    assert response.status_code == 200
    assert Restaurant.objects.all().count() == 1
